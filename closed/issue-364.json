{
  "status": "verified",
  "body": "What version of the product are you using? On what operating system? 1.39 on Windows XP SP3\r\n\r\nI am interested in implementing cards into Magarena, but I am having trouble with the Groovy code. I have been able to add cards that reference other groovy code, for example: Battle Squadron contains \"requires_groovy_code=Scion of the Wild\".\r\n\r\nI have tried adding Balthor The Stout, by editing the Goblin King groovy code.\r\n\r\nGoblin King:\r\n[\r\n    new MagicStatic(\r\n        MagicLayer.Ability,\r\n        MagicTargetFilter.TARGET_GOBLIN_YOU_CONTROL) {\r\n        @Override\r\n        public void modAbilityFlags(final MagicPermanent source,final MagicPermanent permanent,final Set<MagicAbility> flags) {\r\n            flags.add(MagicAbility.Mountainwalk);\r\n        }\r\n        @Override\r\n        public boolean condition(final MagicGame game,final MagicPermanent source,final MagicPermanent target) {\r\n            return source != target;\r\n        }\r\n    },\r\n    new MagicStatic(\r\n        MagicLayer.ModPT,\r\n        MagicTargetFilter.TARGET_GOBLIN_YOU_CONTROL) {\r\n        @Override\r\n        public void modPowerToughness(final MagicPermanent source,final MagicPermanent permanent,final MagicPowerToughness pt) {\r\n            pt.add(1,1);\r\n        }\r\n        @Override\r\n        public boolean condition(final MagicGame game,final MagicPermanent source,final MagicPermanent target) {\r\n            return source != target;\r\n        }\r\n    }\r\n]\r\n\r\n\r\nBalthor:\r\n[\r\n    new MagicStatic(\r\n        MagicLayer.ModPT,\r\n        MagicTargetFilter.TARGET_BARBARIAN_YOU_CONTROL) {\r\n        @Override\r\n        public void modPowerToughness(final MagicPermanent source,final MagicPermanent permanent,final MagicPowerToughness pt) {\r\n            pt.add(1,1);\r\n        }\r\n        @Override\r\n        public boolean condition(final MagicGame game,final MagicPermanent source,final MagicPermanent target) {\r\n            return source != target;\r\n        }\r\n    }\r\n]\r\n\r\nThis causes Magarena to crash on start-up, so I haven't tried adding the second part of Balthor The Stout. I'm not sure what I am doing wrong. The cards that I am referencing do not say \"requires_card_code\", so I don't think that that's the issue. I have tried changing other groovy codes from \"other green creatures\" to \"other white creatures\" on other cards in the same fashion and the game will load, but then crash after starting a duel.",
  "author": "[Mmerrywe...@gmail.com](https://code.google.com/u/118141947219368053798/)",
  "title": "Implementing custom filters in groovy",
  "labels": [
    "imported",
    "Priority-Medium",
    "bug"
  ],
  "comments": [
    {
      "date": "July 07, 2013 19:41:22",
      "body": "Thanks for your help in adding cards. You raised a good question that exposes an issue with the current implementation.\r\n\r\nMagicTargetFilter.TARGET_BARBARIAN_YOU_CONTROL refers to a filter that was previously implemented, MagicTargetFilter.TARGET_BARBARIAN_YOU_CONTROL is something new so you need to provide the implementation for it.\r\n\r\nBtw, it should be TARGET_BARBARIAN instead of TARGET_BARBARIAN_YOU_CONTROL as the effect affects all other barbarians.\r\n\r\nYou can do it as follows, at the top of the script, add the following (before the opening [)\r\n\r\ndef TARGET_BARBARIAN = new MagicPermanentFilterImpl() {                                                                                                                                       \r\n    public boolean accept(final MagicGame game,final MagicPlayer player,final MagicPermanent target) {                                                                                        \r\n        return target.isCreature() && target.hasSubType(MagicSubType.Barbarian);                                                                                                              \r\n    }                                                                                                                                                                                         \r\n};\r\n\r\nThen in your code for the static ability, you use TARGET_BARBARIAN instead of MagicTargetFilter.TARGET_BARBARIAN_YOU_CONTROL.\r\n\r\n[\r\n    new MagicStatic(\r\n        MagicLayer.ModPT,\r\n        TARGET_BARBARIAN) {\r\n...\r\n]\r\n\r\nLook forward to seeing Balthor in game!\r\n\r\nThe current workaround is still somewhat clunky, we will be improving the way to create common filters in groovy code in future releases.\n\n**Summary:** Implementing custom filters in groovy  <span class=\"oldvalue\"> (was: Implementing cards into 1.39) </span>  \n  **Status:** Accepted  \n",
      "author": "[melvinzh...@gmail.com](https://code.google.com/u/108278210804167927868/)"
    },
    {
      "date": "August 31, 2013 22:21:13",
      "body": "Completed the card, will be in 1.42 (Sept) release.\r\n\r\nSee https://code.google.com/p/magarena/source/browse/release/Magarena/scripts/Balthor_the_Stout.txt and https://code.google.com/p/magarena/source/browse/release/Magarena/scripts/Balthor_the_Stout.groovy\n\n**Status:** Fixed  \n",
      "author": "[melvinzh...@gmail.com](https://code.google.com/u/108278210804167927868/)"
    },
    {
      "date": "August 29, 2014 04:28:55",
      "body": "**Status:** Verified  \n",
      "author": "[ShawnieBoyUK](https://code.google.com/u/ShawnieBoyUK/)"
    }
  ],
  "content": "_From [Mmerrywe...@gmail.com](https://code.google.com/u/118141947219368053798/) on July 08, 2013 06:20:39_\n\nWhat version of the product are you using? On what operating system? 1.39 on Windows XP SP3\r\n\r\nI am interested in implementing cards into Magarena, but I am having trouble with the Groovy code. I have been able to add cards that reference other groovy code, for example: Battle Squadron contains \"requires_groovy_code=Scion of the Wild\".\r\n\r\nI have tried adding Balthor The Stout, by editing the Goblin King groovy code.\r\n\r\nGoblin King:\r\n[\r\n    new MagicStatic(\r\n        MagicLayer.Ability,\r\n        MagicTargetFilter.TARGET_GOBLIN_YOU_CONTROL) {\r\n        @Override\r\n        public void modAbilityFlags(final MagicPermanent source,final MagicPermanent permanent,final Set<MagicAbility> flags) {\r\n            flags.add(MagicAbility.Mountainwalk);\r\n        }\r\n        @Override\r\n        public boolean condition(final MagicGame game,final MagicPermanent source,final MagicPermanent target) {\r\n            return source != target;\r\n        }\r\n    },\r\n    new MagicStatic(\r\n        MagicLayer.ModPT,\r\n        MagicTargetFilter.TARGET_GOBLIN_YOU_CONTROL) {\r\n        @Override\r\n        public void modPowerToughness(final MagicPermanent source,final MagicPermanent permanent,final MagicPowerToughness pt) {\r\n            pt.add(1,1);\r\n        }\r\n        @Override\r\n        public boolean condition(final MagicGame game,final MagicPermanent source,final MagicPermanent target) {\r\n            return source != target;\r\n        }\r\n    }\r\n]\r\n\r\n\r\nBalthor:\r\n[\r\n    new MagicStatic(\r\n        MagicLayer.ModPT,\r\n        MagicTargetFilter.TARGET_BARBARIAN_YOU_CONTROL) {\r\n        @Override\r\n        public void modPowerToughness(final MagicPermanent source,final MagicPermanent permanent,final MagicPowerToughness pt) {\r\n            pt.add(1,1);\r\n        }\r\n        @Override\r\n        public boolean condition(final MagicGame game,final MagicPermanent source,final MagicPermanent target) {\r\n            return source != target;\r\n        }\r\n    }\r\n]\r\n\r\nThis causes Magarena to crash on start-up, so I haven't tried adding the second part of Balthor The Stout. I'm not sure what I am doing wrong. The cards that I am referencing do not say \"requires_card_code\", so I don't think that that's the issue. I have tried changing other groovy codes from \"other green creatures\" to \"other white creatures\" on other cards in the same fashion and the game will load, but then crash after starting a duel.\n\n_Original issue: http://code.google.com/p/magarena/issues/detail?id=364_",
  "date": "2013-07-08T06:20:39",
  "state": "closed",
  "gid": 364,
  "link": "http://code.google.com/p/magarena/issues/detail?id=364",
  "owner": ""
}
